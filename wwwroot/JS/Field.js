(()=>{"use strict";var t={7:(t,i,e)=>{e.d(i,{w:()=>a});class a{constructor(t){this.Duration=t,this.KeyFrames=[],this.EasingFunction=t=>t,this.AnimationProgress=0,this.AnimationFrame=0}Duration;KeyFrames;EasingFunction;AnimationProgress;AnimationFrame;static AnimationKeyframes=class{KeyTime;Value;constructor(t,i){this.KeyTime=t,this.Value=i}};addKeyFrame(t,i){this.KeyFrames.push(new a.AnimationKeyframes(t,i)),this.KeyFrames.sort(((t,i)=>t.KeyTime-i.KeyTime))}animate(t,i){const e=performance.now(),a=this.AnimationProgress,s=()=>{const n=performance.now()-e;let h=i?Math.max(a-n/this.Duration,0):Math.min(a+n/this.Duration,1);if(i?h>0:h<1){const i=this.EasingFunction(h),e=this.calculateAnimatedValue(i);t(e),this.AnimationProgress=h,this.AnimationFrame=requestAnimationFrame(s)}};this.AnimationFrame=requestAnimationFrame(s)}startAnimation(t){this.animate(t,!1)}reverseAnimation(t){this.animate(t,!0)}stopAnimation(){cancelAnimationFrame(this.AnimationFrame)}calculateAnimatedValue(t){const i=this.KeyFrames,e=i.find((i=>i.KeyTime>=t));if(e){if(e.KeyTime==t)return e.Value;{const a=i[i.indexOf(e)-1];return a.Value+(e.Value-a.Value)*(t-a.KeyTime)}}return this.KeyFrames[0].Value}SetEasingFunction(t){this.EasingFunction=t}}},517:(t,i,e)=>{e.d(i,{g:()=>s});var a=e(545);class s{Canvas;CanvasWidth;CanvasHeight;ImgX;ImgY;ImgScale=1;Ctx;Image=new Image;Points=[];NewPoint;MouseListeners;TouchListener;constructor(t,i){this.Canvas=t,this.Ctx=t.getContext("2d",{willReadFrequently:!0}),this.Image.src=i,this.CanvasWidth=t.getBoundingClientRect().width,this.CanvasHeight=t.getBoundingClientRect().height,this.ImgX=this.CanvasWidth/2,this.ImgY=this.CanvasHeight/2,this.MouseListeners=new a.x(this),this.TouchListener=new a.z(this),this.Image.onload=()=>{const i=t.width/this.Image.width,e=t.height/this.Image.height;this.ImgScale=Math.min(i,e),requestAnimationFrame(this.draw)}}resize(){if(0==this.CanvasWidth||0==this.CanvasHeight||0==this.Canvas.getBoundingClientRect().width||0==this.Canvas.getBoundingClientRect().height)return;requestAnimationFrame(this.draw);const t=this.Ctx.getImageData(0,0,this.CanvasWidth,this.CanvasHeight);this.CanvasWidth=this.Canvas.clientWidth,this.Canvas.width=this.CanvasWidth,this.CanvasHeight=this.Canvas.clientHeight,this.Canvas.height=this.CanvasHeight;const i=this.CanvasWidth/this.Image.width,e=this.CanvasHeight/this.Image.height;this.ImgScale=Math.min(i,e),this.ImgX=this.CanvasWidth/2,this.ImgY=this.CanvasHeight/2,this.Ctx.putImageData(t,0,0)}draw=()=>{if(0==this.CanvasWidth||0==this.CanvasHeight||0==this.Canvas.getBoundingClientRect().width||0==this.Canvas.getBoundingClientRect().height)return;const t=32/this.ImgScale,i=3/this.ImgScale;this.Ctx.clearRect(0,0,this.Canvas.width,this.Canvas.height),this.Ctx.save(),this.Ctx.translate(this.ImgX,this.ImgY),this.Ctx.scale(this.ImgScale,this.ImgScale),this.Ctx.drawImage(this.Image,-this.Image.width/2,-this.Image.height/2),this.Ctx.lineWidth=i,this.Ctx.font=t+"px Arial";for(let e=this.Points.length-1;e>=0;e--){const a=this.Points[e];this.drawActivityPoints(a,t,i)}this.NewPoint&&this.drawActivityPoints(this.NewPoint,t,i),this.Ctx.restore(),requestAnimationFrame(this.draw)};drawActivityPoints(t,i,e){if(null==t.PosX||null==t.PosY)return;const a=t.PosX,s=t.PosY,n=this.ImgScale;this.Ctx.beginPath(),this.Ctx.arc(a,s,t.CSize/n,0,2*Math.PI),this.Ctx.fillStyle=this.rgbToColor(t.RGBAnimation.R,t.RGBAnimation.G,t.RGBAnimation.B),this.Ctx.fill(),this.Ctx.stroke(),this.Ctx.save(),this.Ctx.fillStyle="white",this.Ctx.strokeStyle="black";const h=this.Ctx.measureText(t.Label).width/2;this.Ctx.strokeText(t.Label,a-h,s-t.CSize/n-i+10/n),this.Ctx.fillText(t.Label,a-h,s-t.CSize/n-i+10/n),this.Ctx.restore()}rgbToColor(t,i,e){return`rgb(${t}, ${i}, ${e})`}}},545:(t,i,e)=>{e.d(i,{x:()=>a,z:()=>s});class a{DragStartX=0;DragStartY=0;IsDragging=!1;Map;constructor(t){this.Map=t}MouseDown(t){this.IsDragging=!0,this.DragStartX=t.clientX-this.Map.ImgX,this.DragStartY=t.clientY-this.Map.ImgY,this.Map.Points.forEach((t=>{t.Hovered&&(this.IsDragging=!1,t.Dragging=!0)})),this.Map.NewPoint&&(this.Map.NewPoint.Dragging=!1,this.Map.Points.push(this.Map.NewPoint),this.Map.NewPoint=void 0)}MouseLeave(t){this.IsDragging=!1,this.Map.Points.forEach((t=>{t.Dragging=!1,t.Hovered=!1,t.ReverseAnimate()}))}MouseMove(t){const i=this.Map.Canvas.getBoundingClientRect(),e=(t.clientX-i.left-this.Map.ImgX)/this.Map.ImgScale,a=(t.clientY-i.top-this.Map.ImgY)/this.Map.ImgScale,s=[];let n=!1,h=!1;this.Map.Points.forEach((t=>{if(null!=t.PosX&&null!=t.PosY){if(!n){const i=Math.sqrt((e-t.PosX)**2+(a-t.PosY)**2);i<t.CSize/this.Map.ImgScale&&!h&&!t.Hovered||t.Dragging?(h=!0,t.Hovered=!0,t.Animate()):(i>t.CSize/this.Map.ImgScale&&t.Hovered&&!t.Dragging||h)&&(t.Hovered=!1,t.ReverseAnimate()),t.Hovered&&(h=!0)}t.Dragging&&!n&&(n=!0,t.PosX=Math.max(-this.Map.Image.width/2,Math.min(e,this.Map.Image.width/2)),t.PosY=Math.max(-this.Map.Image.height/2,Math.min(a,this.Map.Image.height/2)),s.push(t)),this.Map.Points=this.Map.Points.filter((t=>!s.includes(t))),this.Map.Points.unshift(...s)}})),this.IsDragging&&(this.Map.ImgX=this.Map.Image.width*this.Map.ImgScale>this.Map.CanvasWidth?Math.min(Math.max(t.clientX-this.DragStartX,this.Map.CanvasWidth-this.Map.Image.width/2*this.Map.ImgScale),this.Map.Image.width/2*this.Map.ImgScale):this.Map.CanvasWidth/2,this.Map.ImgY=this.Map.Image.height*this.Map.ImgScale>this.Map.CanvasHeight?Math.min(Math.max(t.clientY-this.DragStartY,this.Map.CanvasHeight-this.Map.Image.height/2*this.Map.ImgScale),this.Map.Image.height/2*this.Map.ImgScale):this.Map.CanvasHeight/2),this.Map.NewPoint&&this.Map.NewPoint.Dragging&&!n&&(n=!0,this.Map.NewPoint.PosX=Math.max(-this.Map.Image.width/2,Math.min(e,this.Map.Image.width/2)),this.Map.NewPoint.PosY=Math.max(-this.Map.Image.height/2,Math.min(a,this.Map.Image.height/2)))}MouseUp(){this.IsDragging=!1,this.Map.Points.forEach((t=>{this.IsDragging=!1,t.Dragging=!1}))}Wheel(t){t.preventDefault();const i=t.clientX-this.Map.Canvas.getBoundingClientRect().left,e=t.clientY-this.Map.Canvas.getBoundingClientRect().top,a=this.Map.Canvas.width/this.Map.Image.width,s=this.Map.Canvas.height/this.Map.Image.height,n=.001*-t.deltaY,h=this.Map.ImgScale;this.Map.ImgScale+=n,this.Map.ImgScale=Math.min(Math.max(Math.min(a,s),this.Map.ImgScale),3);const o=this.Map.ImgScale/h,g=this.Map.ImgScale/h;this.Map.ImgX=this.Map.Image.width*this.Map.ImgScale>this.Map.CanvasWidth?Math.min(Math.max(i-(i-this.Map.ImgX)*o,this.Map.CanvasWidth-this.Map.Image.width/2*this.Map.ImgScale),this.Map.Image.width/2*this.Map.ImgScale):this.Map.CanvasWidth/2,this.Map.ImgY=this.Map.Image.height*this.Map.ImgScale>this.Map.CanvasHeight?Math.min(Math.max(e-(e-this.Map.ImgY)*g,this.Map.CanvasHeight-this.Map.Image.height/2*this.Map.ImgScale),this.Map.Image.height/2*this.Map.ImgScale):this.Map.CanvasHeight/2}}class s{Map;dragStartX=0;dragStartY=0;isDragging=!1;initialDistance=null;initialScale=null;constructor(t){this.Map=t}TouchCancel(t){this.isDragging=!1,this.initialDistance=null,this.initialScale=null}TouchEnd(t){t.touches.length<2&&(this.isDragging=!1),0===t.touches.length&&(this.isDragging=!1,this.Map.Points.forEach((t=>{this.isDragging=!1,t.Dragging=!1})))}TouchMove(t){if(t.preventDefault(),2===t.touches.length&&null!==this.initialDistance&&null!==this.initialScale){const i=t.touches[0],e=t.touches[1],a=Math.sqrt(Math.pow(i.clientX-e.clientX,2)+Math.pow(i.clientY-e.clientY,2))/this.initialDistance,s=this.Map.ImgScale,n=this.Map.Canvas.width/this.Map.Image.width,h=this.Map.Canvas.height/this.Map.Image.height,o=(i.clientX+e.clientX)/2,g=(i.clientY+e.clientY)/2,r=this.Map.Canvas.getBoundingClientRect(),m=o-r.left,l=g-r.top;this.Map.ImgScale=this.initialScale*a,this.Map.ImgScale=Math.min(Math.max(Math.min(n,h),this.Map.ImgScale),3);const c=this.Map.ImgScale/s,p=this.Map.ImgScale/s;this.Map.ImgX=this.Map.Image.width*this.Map.ImgScale>this.Map.CanvasWidth?Math.min(Math.max(m-(m-this.Map.ImgX)*c,this.Map.CanvasWidth-this.Map.Image.width/2*this.Map.ImgScale),this.Map.Image.width/2*this.Map.ImgScale):this.Map.CanvasWidth/2,this.Map.ImgY=this.Map.Image.height*this.Map.ImgScale>this.Map.CanvasHeight?Math.min(Math.max(l-(l-this.Map.ImgY)*p,this.Map.CanvasHeight-this.Map.Image.height/2*this.Map.ImgScale),this.Map.Image.height/2*this.Map.ImgScale):this.Map.CanvasHeight/2}else if(1===t.touches.length&&this.isDragging){const i=t.touches[0],e=this.Map.Canvas.getBoundingClientRect(),a=(i.clientX-e.left-this.Map.ImgX)/this.Map.ImgScale,s=(i.clientY-e.top-this.Map.ImgY)/this.Map.ImgScale;let n=!1;this.Map.Points.forEach((t=>{null!=t.PosX&&null!=t.PosY&&t.Dragging&&!n&&(n=!0,t.PosX=Math.max(-this.Map.Image.width/2,Math.min(a,this.Map.Image.width/2)),t.PosY=Math.max(-this.Map.Image.height/2,Math.min(s,this.Map.Image.height/2)))})),n||(this.Map.ImgX=this.Map.Image.width*this.Map.ImgScale>this.Map.CanvasWidth?Math.min(Math.max(i.clientX-this.dragStartX,this.Map.CanvasWidth-this.Map.Image.width/2*this.Map.ImgScale),this.Map.Image.width/2*this.Map.ImgScale):this.Map.CanvasWidth/2,this.Map.ImgY=this.Map.Image.height*this.Map.ImgScale>this.Map.CanvasHeight?Math.min(Math.max(i.clientY-this.dragStartY,this.Map.CanvasHeight-this.Map.Image.height/2*this.Map.ImgScale),this.Map.Image.height/2*this.Map.ImgScale):this.Map.CanvasHeight/2)}}TouchStart(t){if(2===t.touches.length){const i=t.touches[0],e=t.touches[1];this.initialDistance=Math.sqrt(Math.pow(i.clientX-e.clientX,2)+Math.pow(i.clientY-e.clientY,2)),this.initialScale=this.Map.ImgScale}else if(1===t.touches.length){const i=t.touches[0],e=this.Map.Canvas.getBoundingClientRect(),a=(i.clientX-e.left-this.Map.ImgX)/this.Map.ImgScale,s=(i.clientY-e.top-this.Map.ImgY)/this.Map.ImgScale,n=[];let h=!1;this.isDragging=!0,this.dragStartX=i.clientX-this.Map.ImgX,this.dragStartY=i.clientY-this.Map.ImgY,this.Map.Points.forEach((t=>{if(null==t.PosX||null==t.PosY)return;const i=Math.sqrt((a-t.PosX)**2+(s-t.PosY)**2);i<t.CSize/this.Map.ImgScale&&!h||t.Dragging?(h=!0,t.Dragging=!0,t.Hovered=!0,t.Animate(),n.push(t)):(i>t.CSize/this.Map.ImgScale&&!t.Dragging||h)&&(t.Dragging=!1,t.Hovered=!1,t.ReverseAnimate())})),this.Map.Points=this.Map.Points.filter((t=>!n.includes(t))),this.Map.Points.unshift(...n)}}}},219:(t,i,e)=>{function a(t){let i=document.createElement("div");return i.innerHTML=t.trim(),i.firstChild}e.d(i,{zW:()=>a})},875:(t,i,e)=>{e.d(i,{b:()=>n});var a=e(7),s=e(935);class n{PosX;PosY;ID;Label;Type;Hovered;Dragging;CColor;CSize;RGBAnimation;SizeAnimation;constructor(t,i,e,n,h,o,g){this.PosX=n,this.PosY=h,this.ID=o,this.Label=t,this.Type=i,this.Hovered=!1,this.Dragging=g||!1,this.CColor="red",this.CSize=12,this.RGBAnimation=new s.Q(300,"red","blue"),this.SizeAnimation=new a.w(300),this.SizeAnimation.addKeyFrame(0,12),this.SizeAnimation.addKeyFrame(1,24),void 0!==e&&this.SetEasingFunction(e)}Animate(){this.RGBAnimation.Animate(),this.SizeAnimation.stopAnimation(),this.SizeAnimation.startAnimation((t=>{this.CSize=t}))}ReverseAnimate(){this.RGBAnimation.ReverseAnimate(),this.SizeAnimation.stopAnimation(),this.SizeAnimation.reverseAnimation((t=>{this.CSize=t}))}SetEasingFunction(t){this.SizeAnimation.SetEasingFunction(t)}}},935:(t,i,e)=>{e.d(i,{Q:()=>s});var a=e(7);class s{RAnimation;GAnimation;BAnimation;R;G;B;constructor(t,i,e){this.RAnimation=new a.w(t),this.GAnimation=new a.w(t),this.BAnimation=new a.w(t);const s=this.parseColor(i),n=this.parseColor(e);this.R=s[0],this.RAnimation.addKeyFrame(0,s[0]),this.RAnimation.addKeyFrame(1,n[0]),this.G=s[1],this.GAnimation.addKeyFrame(0,s[1]),this.GAnimation.addKeyFrame(1,n[1]),this.B=s[2],this.BAnimation.addKeyFrame(0,s[2]),this.BAnimation.addKeyFrame(1,n[2])}parseColor(t){const i=document.createElement("canvas").getContext("2d");i.fillStyle=t;const e=i.fillStyle;let a;if(e.startsWith("#")){let t=e.slice(1);3===t.length&&(t=t.split("").map((t=>t+t)).join("")),a=[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}else a=e.match(/\d+/g).map(Number);return a}Animate(){this.RAnimation.stopAnimation(),this.RAnimation.startAnimation((t=>{this.R=t})),this.GAnimation.stopAnimation(),this.GAnimation.startAnimation((t=>{this.G=t})),this.BAnimation.stopAnimation(),this.BAnimation.startAnimation((t=>{this.B=t}))}ReverseAnimate(){this.RAnimation.stopAnimation(),this.RAnimation.reverseAnimation((t=>{this.R=t})),this.GAnimation.stopAnimation(),this.GAnimation.reverseAnimation((t=>{this.G=t})),this.BAnimation.stopAnimation(),this.BAnimation.reverseAnimation((t=>{this.B=t}))}SetEasingFunction(t){this.RAnimation.SetEasingFunction(t),this.GAnimation.SetEasingFunction(t),this.BAnimation.SetEasingFunction(t)}}}},i={};function e(a){var s=i[a];if(void 0!==s)return s.exports;var n=i[a]={exports:{}};return t[a](n,n.exports,e),n.exports}e.d=(t,i)=>{for(var a in i)e.o(i,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:i[a]})},e.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i);var a=e(517),s=e(219),n=e(875);class h{Select;Point;constructor(t,i){this.Select=t,this.Point=i,this.Select.addEventListener("change",this.UpdateType)}UpdateType=()=>{this.Point.Type=parseInt(this.Select.value),C(this.Point)}}const o=document.getElementById("FieldCanvas"),g=new a.g(o,imagePath);new ResizeObserver((()=>{g.resize()})).observe(o);const r=document.getElementById("FieldWrapper").querySelector("#MapAddWrapper"),m=r.querySelector("#MapAddButton"),l=document.getElementById("AddActivityWrapper"),c=l.querySelector("#AddActivityForm"),p=c.querySelector("#AddActivityField");let M=document.getElementsByClassName("ActivityWrapper");const d=t=>t<.5?2*t*t:(4-2*t)*t-1;r?.addEventListener("click",(()=>{l.style.scale="1"==l.style.scale?"0":"1",m.classList.toggle("Open")})),l?.querySelector("button")?.addEventListener("click",u),c.addEventListener("submit",(t=>{t.preventDefault(),u()}));for(let t of M){const i=t.querySelector(".Activity");let e=i.getAttribute("PosX"),a=i.getAttribute("PosY"),s=i.getAttribute("ID"),o=i.getAttribute("Name"),r=i.getAttribute("Type");if(i.removeAttribute("PosX"),i.removeAttribute("PosY"),i.removeAttribute("ID"),i.removeAttribute("Name"),i.removeAttribute("Type"),null!==e&&null!==a&&null!==s&&null!==o&&null!==r){let i=parseInt(e),m=parseInt(a),l=parseInt(s),c=parseInt(r),p=new n.b(o,c,d,i,m,l);new h(t.querySelector("select"),p),g.Points.push(p),t.querySelector("button").addEventListener("click",(async()=>{I(p,t)}))}}function u(){const t=p.value,i=l.querySelector("select").value;let e=parseInt(i),a=!1;g.Points.forEach((i=>{i.Label==t&&(a=!0)})),""==t||a||(g.NewPoint=new n.b(t,e,d,void 0,void 0,void 0,!0),l.style.scale="0",m.classList.toggle("Open",!1),p.value="")}async function I(t,i){await S(t,"delete")&&(delete g.Points[g.Points.indexOf(t)],async function(t){t.style.height=t.clientHeight+"px",t.getBoundingClientRect(),t.style.transition="0.8s",t.style.opacity="0",t.style.scale="1 0",t.style.height="0px",t.style.paddingBlock="0",t.style.marginBottom="0",t.style.pointerEvents="none",await new Promise((t=>setTimeout(t,800))),t.remove()}(i))}function v(t){S(t,"create")}function C(t){S(t,"update")}async function S(t,i){if(!t.PosX||!t.PosY)return!1;const e=t.PosX,a=t.PosY,n=t.Label,h=t.Type;let o,g=!1;if(t.ID&&(o=t.ID),void 0!==UpdateFetchPath){const r=`${UpdateFetchPath}&Statement=${i}&X=${e}&Y=${a}&Label=${n}&Type=${h}${o?`&ID=${o}`:""}`;await fetch(r).then((t=>t.json())).then((i=>{if(g=i.status,i.id){const e=(0,s.zW)(i.string);e.querySelector("button").addEventListener("click",(async()=>{I(t,e)})),t.ID=parseInt(i.id),document.getElementById("ActivityList")?.appendChild(e),async function(t){t.style.transition="0.8s",t.style.opacity="0",t.style.scale="1 0",t.style.paddingBlock="0",t.style.marginBottom="0",t.style.pointerEvents="none",t.getBoundingClientRect(),t.style.opacity="1",t.style.scale="1 1",t.style.paddingBlock="2rem",t.style.marginBottom="2rem",t.style.pointerEvents="all",await new Promise((t=>setTimeout(t,800))),t.style.transition=""}(e)}}))}return g}o.addEventListener("mousedown",(t=>{g.NewPoint&&v(g.NewPoint),g.MouseListeners.MouseDown(t)})),o.addEventListener("mouseup",(()=>{g.Points.forEach((t=>{t.Dragging&&C(t)})),g.MouseListeners.MouseUp()})),o.addEventListener("mousemove",(t=>{g.MouseListeners.MouseMove(t)})),o.addEventListener("mouseleave",(t=>{g.MouseListeners.MouseLeave(t)})),o.addEventListener("wheel",(t=>{g.MouseListeners.Wheel(t)}),{passive:!1}),o.addEventListener("touchstart",(t=>{g.NewPoint&&v(g.NewPoint),g.TouchListener.TouchStart(t)}),{passive:!1}),o.addEventListener("touchmove",(t=>{g.TouchListener.TouchMove(t)}),{passive:!1}),o.addEventListener("touchend",(t=>{g.Points.forEach((t=>{t.Dragging&&C(t)})),g.TouchListener.TouchEnd(t)})),o.addEventListener("touchcancel",(t=>{g.TouchListener.TouchCancel(t)}))})();